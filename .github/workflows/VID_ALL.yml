
name: Daily Data Update with Debugging

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:      # Manual trigger

jobs:
  update-files:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Confirm checkout success
      run: echo "âœ… Repo checked out successfully"

    - name: List all files and folders in repo
      run: |
        echo "ðŸ“‚ Repo file structure:"
        ls -alR

    - name: Show vid files presence and sample content
      run: |
        for f in vid1_short.txt vid2_short.txt vid3_short.txt vid1_long.txt vid2_long.txt vid3_long.txt; do
          if [ -f "$f" ]; then
            echo "âœ… File $f exists. First 3 lines:"
            head -n 3 "$f"
          else
            echo "âŒ File $f NOT found!"
          fi
        done

    - name: Merge short files
      run: |
        echo "Merging short files..."
        cat vid1_short.txt vid2_short.txt vid3_short.txt > VID_ALL_SHORTS.txt
        echo "âœ… Merged shorts into VID_ALL_SHORTS.txt"
        echo "VID_ALL_SHORTS.txt sample content:"
        head -n 5 VID_ALL_SHORTS.txt

    - name: Merge long files
      run: |
        echo "Merging long files..."
        cat vid1_long.txt vid2_long.txt vid3_long.txt > VID_ALL_LONG.txt
        echo "âœ… Merged longs into VID_ALL_LONG.txt"
        echo "VID_ALL_LONG.txt sample content:"
        head -n 5 VID_ALL_LONG.txt

    - name: Configure git user
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        echo "âœ… Git user configured"

    - name: Check if merged files changed
      id: files_changed
      run: |
        git add VID_ALL_SHORTS.txt VID_ALL_LONG.txt
        # Check if there are changes to commit
        if git diff --cached --quiet; then
          echo "changed=false" >> $GITHUB_OUTPUT
          echo "No changes to commit."
        else
          echo "changed=true" >> $GITHUB_OUTPUT
          echo "Changes detected."
        fi

    - name: Commit and push if changed
      if: steps.files_changed.outputs.changed == 'true'
      run: |
        git commit -m "Auto-merge shorts and longs - $(date -u)"
        echo "âœ… Committed changes"
        git push origin main
        echo "âœ… Pushed changes"
