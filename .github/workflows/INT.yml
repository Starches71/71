
name: Tor YouTube Download

on:
  workflow_dispatch:

jobs:
  download_video:
    runs-on: ubuntu-latest

    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Set up Tor
      run: |
        sudo apt-get update
        sudo apt-get install tor
        sudo service tor start

    - name: Update yt-dlp to the latest version
      run: |
        python3 -m pip install --upgrade yt-dlp

    - name: Check Tor exit node IP
      run: |
        echo "Checking Tor exit node IP..."
        curl --socks5 127.0.0.1:9050 https://check.torproject.org/api/ip

    - name: Resolve youtube.com via Tor
      run: |
        echo "Resolving youtube.com via Tor..."
        curl --socks5 127.0.0.1:9050 https://dns.google.com/resolve?name=www.youtube.com&type=A

    - name: Download YouTube video via Tor using yt-dlp
      run: |
        export http_proxy="http://127.0.0.1:8118"
        yt-dlp --proxy "socks5://127.0.0.1:9050" -f bestvideo+bestaudio https://www.youtube.com/watch?v=dQw4w9WgXcQ

    - name: Verify the downloaded video
      run: |
        ls -lh
        echo "Download complete"
