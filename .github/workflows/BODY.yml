
name: YOLOv7 Object Detection

on:
  workflow_dispatch:

jobs:
  detect:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
          git clone https://github.com/WongKinYiu/yolov7.git
          cd yolov7
          pip install -r requirements.txt

      - name: Run YOLOv7 on video
        run: |
          cd yolov7
          mkdir -p runs/detect
          python detect.py \
            --weights yolov7.pt \
            --conf 0.25 \
            --source "../iPhone_16_Pro_Max_VS_S24_Ultra_-_Ultimate_selfie_test!(360p).mp4" \
            --project runs/detect \
            --name output \
            --exist-ok

      - name: Upload detection result frames
        uses: actions/upload-artifact@v3
        with:
          name: yolo7-output
          path: yolov7/runs/detect/output
