
name: Remove Person from Video with Lama Cleaner

on:
  workflow_dispatch:

jobs:
  remove-person:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Checkout Repository
      uses: actions/checkout@v3

    - name: 🛠️ Install Dependencies (Python + FFmpeg)
      run: |
        sudo apt update
        sudo apt install -y ffmpeg
        pip install lama-cleaner

    - name: 🖼️ Extract Video Frames
      run: |
        mkdir -p frames
        ffmpeg -i "iPhone_16_Pro_Max_VS_S24_Ultra_-_Ultimate_selfie_test!(360p).mp4" -q:v 2 frames/frame_%05d.png

    - name: 🤖 Remove Person with Lama Cleaner
      run: |
        lama-cleaner \
          --input-dir frames \
          --output-dir outframes \
          --model lama \
          --device cpu \
          --no-half \
          --resize-limit 1024 \
          --mask-mode object \
          --interactive false

    - name: 🎬 Reassemble Processed Frames into Video
      run: |
        ffmpeg -framerate 24 -i outframes/frame_%05d.png -c:v libx264 -pix_fmt yuv420p result.mp4

    - name: 📤 Upload Processed Video
      uses: actions/upload-artifact@v3
      with:
        name: processed-video
        path: result.mp4
